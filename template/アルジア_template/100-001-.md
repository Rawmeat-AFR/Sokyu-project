---
番号: 100-
省庁: 皇府
最終更新: <% tp.date.now("YYYY-MM-DD-MM-SS") %>
---
<%*
const counterFile = "_system/record_counter.md";

// frontmatter から prefix を読む
const prefix = tp.frontmatter.record_id;

// counters は「prefix: lastNumber」
let counters = await tp.file.read(counterFile);
let regex = new RegExp(`^${prefix}(\\d+)$`, "m");
let match = counters.match(regex);

let num = match ? parseInt(match[1]) + 1 : 1;

// counter 更新
let newCounters;
if (match) {
  newCounters = counters.replace(regex, `${prefix}${num}`);
} else {
  newCounters = counters + `\n${prefix}${num}`;
}
await tp.file.write(counterFile, newCounters);

const fullId = `${prefix}${String(num).padStart(5, "0")}`;

// frontmatter を上書き
tp.frontmatter.record_id = fullId;
%>