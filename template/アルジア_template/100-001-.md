---
番号: 100-
省庁: 皇府
---

<%*
const counterFile = "_system/record_counter.md";
const prefix = tp.frontmatter["番号"];

// カウンタファイルがなければ作る
if (!(await tp.file.exists(counterFile))) {
  await tp.file.write(counterFile, "");
}

const raw = await tp.file.read(counterFile);
const counters = Object.fromEntries(
  raw.split("\n")
    .filter(Boolean)
    .map(l => l.split(": "))
);

const next = (parseInt(counters[prefix] || "0") + 1);
counters[prefix] = next;

// 保存
await tp.file.write(
  counterFile,
  Object.entries(counters).map(([k,v]) => `${k}: ${v}`).join("\n")
);

// frontmatter を安全に更新
const fullId = `${prefix}${String(next).padStart(5, "0")}`;

await tp.file.setFrontmatter({
  番号: fullId,
  最終更新: tp.date.now("YYYY-MM-DD-HH-mm-ss")
});
%>
